<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Valentine Game</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>

<style>
  :root {
    --bg: #fff0f7;
    --panel: rgba(255,245,250,0.92);
    --border: #a06e87;
    --text: #78465f;
    --btn: rgba(255, 225, 238, 0.95);
    --btn2: rgba(255, 205, 230, 0.95);

    /* ✅ Адаптивные размеры кнопок */
    --btnSize: clamp(40px, 10vw, 54px);       /* стрелки */
    --btnGap:  clamp(6px,  1.6vw, 10px);      /* расстояние */
    --wideW:   clamp(120px, 34vw, 160px);     /* OPEN/MENU */
    --wideH:   clamp(40px, 10vw, 54px);       /* высота wide */
    --pad:     clamp(8px,  2.2vw, 12px);      /* отступы панели */
  }

  #mobileControls {
    position: absolute;
    left: 10px;
    right: 10px;
    bottom: 10px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    pointer-events: none;
  }

  .pad, .actions {
    pointer-events: auto;
    background: var(--panel);
    border: 2px solid var(--border);
    border-radius: 18px;
    padding: var(--pad);
    display: grid;
    gap: 8px;
    align-content: center;
    justify-items: center;
  }

  .dpad {
    display: grid;
    grid-template-columns: var(--btnSize) var(--btnSize) var(--btnSize);
    grid-template-rows:    var(--btnSize) var(--btnSize) var(--btnSize);
    gap: var(--btnGap);
  }

  .btn {
    width: var(--btnSize);
    height: var(--btnSize);
    border-radius: 14px;
    border: 2px solid rgba(160,110,135,0.35);
    background: var(--btn);
    color: var(--text);
    font-size: clamp(14px, 3.6vw, 18px); /* ✅ адаптивный размер символа */
    font-weight: bold;
    display: grid;
    place-items: center;
    user-select: none;
    touch-action: manipulation;
  }

  .actions .btnWide {
    width: var(--wideW);
    height: var(--wideH);
    border-radius: 14px;
    border: 2px solid rgba(160,110,135,0.35);
    background: var(--btn2);
    color: var(--text);
    font-size: clamp(12px, 3.2vw, 16px); /* ✅ адаптивный текст */
    font-weight: bold;
    display: grid;
    place-items: center;
    user-select: none;
    touch-action: manipulation;
  }

  /* ✅ На очень маленьких экранах (iPhone SE и т.п.) ещё чуть уменьшим */
  @media (max-width: 360px) {
    :root {
      --btnSize: clamp(36px, 10vw, 44px);
      --wideW:   clamp(110px, 36vw, 140px);
      --wideH:   clamp(36px, 10vw, 44px);
    }
  }

  /* Hide mobile controls on desktop-ish widths */
  @media (min-width: 900px) {
    #mobileControls { display: none; }
  }
</style>

  
</head>

<body>
  <div id="wrap">
    <div id="game">
      <!-- p5 will insert canvas here -->
      <div id="mobileControls">
        <div class="pad">
          <div class="dpad">
            <div></div>
            <div class="btn" id="btnUp">▲</div>
            <div></div>
            <div class="btn" id="btnLeft">◀</div>
            <div></div>
            <div class="btn" id="btnRight">▶</div>
            <div></div>
            <div class="btn" id="btnDown">▼</div>
            <div></div>
          </div>
        </div>

        <div class="actions">
          <div class="btnWide" id="btnOpen">OPEN / E</div>
          <div class="btnWide" id="btnMenu">MENU / R</div>
        </div>
      </div>
    </div>

    <div id="consolePanel">
      <div id="consoleHeader">
        Управление: стрелки/WASD, <b>E</b> открыть письмо, <b>R</b> меню.
        Консоль: <code>up</code> <code>down</code> <code>left</code> <code>right</code> / <code>go right 3</code> / <code>open</code>
      </div>

      <div id="consoleLog"></div>

      <div id="consoleRow">
        <input id="consoleInput" placeholder="Например: go right 3  |  up  |  open" autocomplete="off"/>
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script src="sketch.js"></script>

  <script>
    // Вызовы в sketch.js будут доступны через window.gameCmd(...)
    const input = document.getElementById("consoleInput");
    const sendBtn = document.getElementById("sendBtn");

    function sendConsoleCommand(){
      const v = input.value.trim();
      if(!v) return;
      if(window.gameCmd) window.gameCmd(v);
      input.value = "";
      input.focus();
    }

    input.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") sendConsoleCommand();
    });
    sendBtn.addEventListener("click", sendConsoleCommand);

    // Mobile buttons
    function hook(id, cmd){
      const el = document.getElementById(id);
      const fire = (e)=>{ e.preventDefault(); if(window.gameCmd) window.gameCmd(cmd); };
      el.addEventListener("click", fire);
      el.addEventListener("touchstart", fire, {passive:false});
    }
    hook("btnUp", "up");
    hook("btnDown", "down");
    hook("btnLeft", "left");
    hook("btnRight", "right");
    hook("btnOpen", "open");
    hook("btnMenu", "menu");
  </script>
</body>
</html>

