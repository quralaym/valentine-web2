<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Valentine Game</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>

  <style>
    :root {
      --bg: #fff0f7;
      --panel: rgba(255,245,250,0.92);
      --border: #a06e87;
      --text: #78465f;
      --btn: rgba(255, 225, 238, 0.95);
      --btn2: rgba(255, 205, 230, 0.95);
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: Arial, sans-serif;
      height: 100%;
      overflow: hidden;
    }

    #wrap {
      position: fixed;
      inset: 0;
      display: grid;
      grid-template-rows: 1fr auto;
    }

    /* Canvas container */
    #game {
      position: relative;
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
      padding: 8px;
      box-sizing: border-box;
    }

    /* Console panel */
    #consolePanel {
      width: min(980px, calc(100vw - 16px));
      background: var(--panel);
      border: 2px solid var(--border);
      border-radius: 16px;
      margin: 8px auto;
      box-sizing: border-box;
      padding: 10px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    #consoleHeader {
      color: var(--text);
      font-weight: bold;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 14px;
    }

    #consoleLog {
      height: 90px;
      overflow: auto;
      background: rgba(255,255,255,0.7);
      border: 1px solid rgba(160,110,135,0.35);
      border-radius: 12px;
      padding: 8px;
      color: var(--text);
      font-size: 13px;
      line-height: 1.35;
      white-space: pre-wrap;
    }

    #consoleRow {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }

    #consoleInput {
      width: 100%;
      font-size: 16px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 2px solid rgba(160,110,135,0.35);
      outline: none;
      box-sizing: border-box;
    }

    #sendBtn {
      padding: 10px 14px;
      border-radius: 12px;
      border: 2px solid rgba(160,110,135,0.35);
      background: var(--btn2);
      color: var(--text);
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }

    /* Mobile controls */
    #mobileControls {
      position: absolute;
      inset: auto 12px 12px 12px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      pointer-events: none; /* enable only buttons */
    }

    .pad, .actions {
      pointer-events: auto;
      background: var(--panel);
      border: 2px solid var(--border);
      border-radius: 18px;
      padding: 10px;
      display: grid;
      gap: 8px;
      align-content: center;
      justify-items: center;
    }

    .dpad {
      display: grid;
      grid-template-columns: 56px 56px 56px;
      grid-template-rows: 56px 56px 56px;
      gap: 8px;
    }

    .btn {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      border: 2px solid rgba(160,110,135,0.35);
      background: var(--btn);
      color: var(--text);
      font-size: 18px;
      font-weight: bold;
      display: grid;
      place-items: center;
      user-select: none;
      touch-action: manipulation;
    }

    .btn:active { transform: scale(0.98); }

    .actions .btnWide {
      width: 140px;
      height: 56px;
      border-radius: 16px;
      border: 2px solid rgba(160,110,135,0.35);
      background: var(--btn2);
      color: var(--text);
      font-size: 16px;
      font-weight: bold;
      display: grid;
      place-items: center;
      user-select: none;
      touch-action: manipulation;
    }

    /* Hide mobile controls on desktop-ish widths */
    @media (min-width: 900px) {
      #mobileControls { display: none; }
    }
  </style>
</head>

<body>
  <div id="wrap">
    <div id="game">
      <!-- p5 will insert canvas here -->
      <div id="mobileControls">
        <div class="pad">
          <div class="dpad">
            <div></div>
            <div class="btn" id="btnUp">▲</div>
            <div></div>
            <div class="btn" id="btnLeft">◀</div>
            <div></div>
            <div class="btn" id="btnRight">▶</div>
            <div></div>
            <div class="btn" id="btnDown">▼</div>
            <div></div>
          </div>
        </div>

        <div class="actions">
          <div class="btnWide" id="btnOpen">OPEN / E</div>
          <div class="btnWide" id="btnMenu">MENU / R</div>
        </div>
      </div>
    </div>

    <div id="consolePanel">
      <div id="consoleHeader">
        Управление: стрелки/WASD, <b>E</b> открыть письмо, <b>R</b> меню.
        Консоль: <code>up</code> <code>down</code> <code>left</code> <code>right</code> / <code>go right 3</code> / <code>open</code>
      </div>

      <div id="consoleLog"></div>

      <div id="consoleRow">
        <input id="consoleInput" placeholder="Например: go right 3  |  up  |  open" autocomplete="off"/>
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script src="sketch.js"></script>

  <script>
    // Вызовы в sketch.js будут доступны через window.gameCmd(...)
    const input = document.getElementById("consoleInput");
    const sendBtn = document.getElementById("sendBtn");

    function sendConsoleCommand(){
      const v = input.value.trim();
      if(!v) return;
      if(window.gameCmd) window.gameCmd(v);
      input.value = "";
      input.focus();
    }

    input.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") sendConsoleCommand();
    });
    sendBtn.addEventListener("click", sendConsoleCommand);

    // Mobile buttons
    function hook(id, cmd){
      const el = document.getElementById(id);
      const fire = (e)=>{ e.preventDefault(); if(window.gameCmd) window.gameCmd(cmd); };
      el.addEventListener("click", fire);
      el.addEventListener("touchstart", fire, {passive:false});
    }
    hook("btnUp", "up");
    hook("btnDown", "down");
    hook("btnLeft", "left");
    hook("btnRight", "right");
    hook("btnOpen", "open");
    hook("btnMenu", "menu");
  </script>
</body>
</html>
